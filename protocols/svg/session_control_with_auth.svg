<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' contentScriptType='application/ecmascript' contentStyleType='text/css' height='1100px' preserveAspectRatio='none' style='width:683px;height:1100px;' version='1.1' viewBox='0 0 683 1100' width='683px' zoomAndPan='magnify'>
  <defs>
    <filter height='300%' id='fof0g39tjxrbs' width='300%' x='-1' y='-1'>
      <feGaussianBlur result='blurOut' stdDeviation='2.0'/>
      <feColorMatrix in='blurOut' result='blurOut2' type='matrix' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0'/>
      <feOffset dx='4.0' dy='4.0' in='blurOut2' result='blurOut3'/>
      <feBlend in='SourceGraphic' in2='blurOut3' mode='normal'/>
    </filter>
  </defs>
  <g>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='300.5' x='152' y='72.6211'/>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='146.1973' style='stroke: #000000; stroke-width: 2.0;' width='509' x='152' y='162.5527'/>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='289.1055' style='stroke: #000000; stroke-width: 2.0;' width='609' x='13' y='322.75'/>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='452' x='152' y='405.6816'/>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='213.7949' style='stroke: #000000; stroke-width: 2.0;' width='414' x='142' y='625.8555'/>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='92.5527' style='stroke: #000000; stroke-width: 2.0;' width='394' x='152' y='650.166'/>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='327' x='152' y='756.7188'/>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='300.5' x='152' y='853.6504'/>
    <rect fill='#FFFFFF' filter='url(#fof0g39tjxrbs)' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='300.5' x='152' y='943.582'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='191' y1='55.6211' y2='238.4844'/>
    <line style='stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;' x1='191' x2='191' y1='238.4844' y2='279.4395'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='191' y1='279.4395' y2='1036.5137'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='411.5' x2='411.5' y1='55.6211' y2='238.4844'/>
    <line style='stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;' x1='411.5' x2='411.5' y1='238.4844' y2='279.4395'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='411.5' x2='411.5' y1='279.4395' y2='1036.5137'/>
    <rect fill='#FEFECE' filter='url(#fof0g39tjxrbs)' height='30.4883' style='stroke: #A80036; stroke-width: 1.5;' width='54' x='162' y='20.1328'/>
    <text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacingAndGlyphs' textLength='40' x='169' y='40.668'>
      Client
    </text>
    <rect fill='#FEFECE' filter='url(#fof0g39tjxrbs)' height='30.4883' style='stroke: #A80036; stroke-width: 1.5;' width='54' x='162' y='1035.5137'/>
    <text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacingAndGlyphs' textLength='40' x='169' y='1056.0488'>
      Client
    </text>
    <rect fill='#FEFECE' filter='url(#fof0g39tjxrbs)' height='30.4883' style='stroke: #A80036; stroke-width: 1.5;' width='57' x='381.5' y='20.1328'/>
    <text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacingAndGlyphs' textLength='43' x='388.5' y='40.668'>
      Server
    </text>
    <rect fill='#FEFECE' filter='url(#fof0g39tjxrbs)' height='30.4883' style='stroke: #A80036; stroke-width: 1.5;' width='57' x='381.5' y='1035.5137'/>
    <text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacingAndGlyphs' textLength='43' x='388.5' y='1056.0488'>
      Server
    </text>
    <path d='M152,72.6211 L421,72.6211 L421,79.6211 L411,89.6211 L152,89.6211 L152,72.6211 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='300.5' x='152' y='72.6211'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='224' x='167' y='86.1895'>
      Connect to secure WebSocket URI
    </text>
    <polygon fill='#A80036' points='400,107.2422,410,111.2422,400,115.2422,404,111.2422' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='111.2422' y2='111.2422'/>
    <a href='https://tools.ietf.org/html/rfc6455#section-1.3' xlink:href='https://tools.ietf.org/html/rfc6455#section-1.3' target='_top' title='https://tools.ietf.org/html/rfc6455#section-1.3' xlink:title='https://tools.ietf.org/html/rfc6455#section-1.3' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='197' x='203' y='106.5'>
        WebSocket Opening handshake
      </text>
    </a>
    <polygon fill='#A80036' points='202,136.5527,192,140.5527,202,144.5527,198,140.5527' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='140.5527' y2='140.5527'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='197' x='203' y='135.8105'>
      WebSocket Opening handshake
    </text>
    <path d='M152,162.5527 L656,162.5527 L656,169.5527 L646,179.5527 L152,179.5527 L152,162.5527 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='146.1973' style='stroke: #000000; stroke-width: 2.0;' width='509' x='152' y='162.5527'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='185' x='167' y='176.1211'>
      [OPTIONAL] Authentication
    </text>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='121' x='356' y='176.1211'>
      (see if required in
    </text>
    <a href='#WS_API_Services' xlink:href='#WS_API_Services' target='_top' title='#WS_API_Services' xlink:title='#WS_API_Services' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='140' x='481' y='176.1211'>
        Table of API Services
      </text>
    </a>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='5' x='621' y='176.1211'>
      )
    </text>
    <polygon fill='#A80036' points='400,197.1738,410,201.1738,400,205.1738,404,201.1738' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='201.1738' y2='201.1738'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='276.5' y='196.4316'>
      1)
    </text>
    <a href='#login' xlink:href='#login' target='_top' title='#login' xlink:title='#login' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='34' x='292.5' y='196.4316'>
        login
      </text>
    </a>
    <polygon fill='#A80036' points='202,226.4844,192,230.4844,202,234.4844,198,230.4844' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='230.4844' y2='230.4844'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='242.5' y='225.7422'>
      2)
    </text>
    <a href='#login_accepted' xlink:href='#login_accepted' target='_top' title='#login_accepted' xlink:title='#login_accepted' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='102' x='258.5' y='225.7422'>
        login_accepted
      </text>
    </a>
    <text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacingAndGlyphs' textLength='0' x='244' y='263.1191'/>
    <text fill='#000000' font-family='sans-serif' font-size='11' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='112' x='244' y='263.1191'>
      or in case of failure
    </text>
    <text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacingAndGlyphs' textLength='3' x='356' y='263.1191'>
      :
    </text>
    <polygon fill='#A80036' points='202,296.75,192,300.75,202,304.75,198,300.75' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;' x1='196' x2='411' y1='300.75' y2='300.75'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='245.5' y='296.0078'>
      2)
    </text>
    <a href='#login_rejected' xlink:href='#login_rejected' target='_top' title='#login_rejected' xlink:title='#login_rejected' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='96' x='261.5' y='296.0078'>
        login_rejected
      </text>
    </a>
    <path d='M13,322.75 L177,322.75 L177,329.75 L167,339.75 L13,339.75 L13,322.75 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='289.1055' style='stroke: #000000; stroke-width: 2.0;' width='609' x='13' y='322.75'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='119' x='28' y='336.3184'>
      Session openning
    </text>
    <polygon fill='#A80036' points='400,357.3711,410,361.3711,400,365.3711,404,361.3711' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='361.3711' y2='361.3711'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='249.5' y='356.6289'>
      1)
    </text>
    <a href='#start_session' xlink:href='#start_session' target='_top' title='#start_session' xlink:title='#start_session' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='88' x='265.5' y='356.6289'>
        start_session
      </text>
    </a>
    <polygon fill='#A80036' points='202,386.6816,192,390.6816,202,394.6816,198,390.6816' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='390.6816' y2='390.6816'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='241' y='385.9395'>
      2)
    </text>
    <a href='#session_started' xlink:href='#session_started' target='_top' title='#session_started' xlink:title='#session_started' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='105' x='257' y='385.9395'>
        session_started
      </text>
    </a>
    <path d='M152,405.6816 L599,405.6816 L599,412.6816 L589,422.6816 L152,422.6816 L152,405.6816 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='452' x='152' y='405.6816'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='402' x='167' y='419.25'>
      to keep session alive, heartbeating is required from now on
    </text>
    <polygon fill='#A80036' points='202,440.3027,192,444.3027,202,448.3027,198,444.3027' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='444.3027' y2='444.3027'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='11' x='261' y='439.5605'>
      a)
    </text>
    <a href='#heartbeat' xlink:href='#heartbeat' target='_top' title='#heartbeat' xlink:title='#heartbeat' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='66' x='276' y='439.5605'>
        heartbeat
      </text>
    </a>
    <polygon fill='#A80036' points='400,469.6133,410,473.6133,400,477.6133,404,473.6133' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='473.6133' y2='473.6133'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='260.5' y='468.8711'>
      b)
    </text>
    <a href='#heartbeat' xlink:href='#heartbeat' target='_top' title='#heartbeat' xlink:title='#heartbeat' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='66' x='276.5' y='468.8711'>
        heartbeat
      </text>
    </a>
    <polygon fill='#A80036' points='202,510.9238,192,514.9238,202,518.9238,198,514.9238' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='514.9238' y2='514.9238'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='241.5' y='510.1816'>
      3)
    </text>
    <a href='#channel_added' xlink:href='#channel_added' target='_top' title='#channel_added' xlink:title='#channel_added' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='104' x='257.5' y='510.1816'>
        channel_added
      </text>
    </a>
    <path d='M417,493.6133 L417,518.6133 L603,518.6133 L603,503.6133 L593,493.6133 L417,493.6133 ' fill='#FBFB77' filter='url(#fof0g39tjxrbs)' style='stroke: #A80036; stroke-width: 1.0;'/>
    <path d='M593,493.6133 L593,503.6133 L603,503.6133 L593,493.6133 ' fill='#FBFB77' style='stroke: #A80036; stroke-width: 1.0;'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='87' x='423' y='511.1816'>
      with assigned
    </text>
    <a href='#channel_id' xlink:href='#channel_id' target='_top' title='#channel_id' xlink:title='#channel_id' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='74' x='514' y='511.1816'>
        channel_id
      </text>
    </a>
    <polygon fill='#A80036' points='400,557.8896,410,561.8896,400,565.8896,404,561.8896' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='561.8896' y2='561.8896'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='240.5' y='557.1475'>
      4)
    </text>
    <a href='#request_stream' xlink:href='#request_stream' target='_top' title='#request_stream' xlink:title='#request_stream' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='106' x='256.5' y='557.1475'>
        request_stream
      </text>
    </a>
    <path d='M23,532.9238 L23,572.9238 L182,572.9238 L182,542.9238 L172,532.9238 L23,532.9238 ' fill='#FBFB77' filter='url(#fof0g39tjxrbs)' style='stroke: #A80036; stroke-width: 1.0;'/>
    <path d='M172,532.9238 L172,542.9238 L182,542.9238 L172,532.9238 ' fill='#FBFB77' style='stroke: #A80036; stroke-width: 1.0;'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='27' x='29' y='550.4922'>
      with
    </text>
    <a href='#channel_id' xlink:href='#channel_id' target='_top' title='#channel_id' xlink:title='#channel_id' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='74' x='60' y='550.4922'>
        channel_id
      </text>
    </a>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='30' x='29' y='565.8027'>
      from
    </text>
    <a href='#channel_added' xlink:href='#channel_added' target='_top' title='#channel_added' xlink:title='#channel_added' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='104' x='63' y='565.8027'>
        channel_added
      </text>
    </a>
    <polygon fill='#A80036' points='202,599.8555,192,603.8555,202,607.8555,198,603.8555' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='603.8555' y2='603.8555'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='242.5' y='599.1133'>
      5)
    </text>
    <a href='#stream_started' xlink:href='#stream_started' target='_top' title='#stream_started' xlink:title='#stream_started' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='102' x='258.5' y='599.1133'>
        stream_started
      </text>
    </a>
    <path d='M142,625.8555 L353,625.8555 L353,632.8555 L343,642.8555 L142,642.8555 L142,625.8555 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='213.7949' style='stroke: #000000; stroke-width: 2.0;' width='414' x='142' y='625.8555'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='166' x='157' y='639.4238'>
      Service-specific protocol
    </text>
    <path d='M152,650.166 L541,650.166 L541,703.166 L531,713.166 L152,713.166 L152,650.166 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='92.5527' style='stroke: #000000; stroke-width: 2.0;' width='394' x='152' y='650.166'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='143' x='167' y='663.7344'>
      to keep session alive,
    </text>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='302' x='167' y='679.0449'>
      make sure that Client is idle less than 15 sec
    </text>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='76' x='167' y='694.3555'>
      by sending
    </text>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='66' x='247' y='694.3555'>
      heartbeat
    </text>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='194' x='317' y='694.3555'>
      to Server during idle periods
    </text>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='241' x='167' y='709.666'>
      so Server will see that Client is alive
    </text>
    <polygon fill='#A80036' points='400,730.7188,410,734.7188,400,738.7188,404,734.7188' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='734.7188' y2='734.7188'/>
    <a href='#heartbeat' xlink:href='#heartbeat' target='_top' title='#heartbeat' xlink:title='#heartbeat' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='66' x='268.5' y='729.9766'>
        heartbeat
      </text>
    </a>
    <path d='M152,756.7188 L474,756.7188 L474,763.7188 L464,773.7188 L152,773.7188 L152,756.7188 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='327' x='152' y='756.7188'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='277' x='167' y='770.2871'>
      always handshake Server's heartbeat too
    </text>
    <polygon fill='#A80036' points='202,791.3398,192,795.3398,202,799.3398,198,795.3398' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='795.3398' y2='795.3398'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='11' x='261' y='790.5977'>
      a)
    </text>
    <a href='#heartbeat' xlink:href='#heartbeat' target='_top' title='#heartbeat' xlink:title='#heartbeat' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='66' x='276' y='790.5977'>
        heartbeat
      </text>
    </a>
    <polygon fill='#A80036' points='400,820.6504,410,824.6504,400,828.6504,404,824.6504' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='824.6504' y2='824.6504'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='260.5' y='819.9082'>
      b)
    </text>
    <a href='#heartbeat' xlink:href='#heartbeat' target='_top' title='#heartbeat' xlink:title='#heartbeat' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='66' x='276.5' y='819.9082'>
        heartbeat
      </text>
    </a>
    <path d='M152,853.6504 L299,853.6504 L299,860.6504 L289,870.6504 L152,870.6504 L152,853.6504 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='300.5' x='152' y='853.6504'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='102' x='167' y='867.2188'>
      Session ending
    </text>
    <polygon fill='#A80036' points='400,888.2715,410,892.2715,400,896.2715,404,892.2715' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='892.2715' y2='892.2715'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='272' y='887.5293'>
      1)
    </text>
    <a href='#logout' xlink:href='#logout' target='_top' title='#logout' xlink:title='#logout' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='43' x='288' y='887.5293'>
        logout
      </text>
    </a>
    <polygon fill='#A80036' points='202,917.582,192,921.582,202,925.582,198,921.582' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='921.582' y2='921.582'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='12' x='243.5' y='916.8398'>
      2)
    </text>
    <a href='#session_ended' xlink:href='#session_ended' target='_top' title='#session_ended' xlink:title='#session_ended' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='100' x='259.5' y='916.8398'>
        session_ended
      </text>
    </a>
    <path d='M152,943.582 L323,943.582 L323,950.582 L313,960.582 L152,960.582 L152,943.582 ' fill='#EEEEEE' style='stroke: #000000; stroke-width: 1.0;'/>
    <rect fill='none' height='75.9316' style='stroke: #000000; stroke-width: 2.0;' width='300.5' x='152' y='943.582'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacingAndGlyphs' textLength='126' x='167' y='957.1504'>
      Closing WebSocket
    </text>
    <polygon fill='#A80036' points='400,978.2031,410,982.2031,400,986.2031,404,982.2031' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='191' x2='406' y1='982.2031' y2='982.2031'/>
    <a href='https://tools.ietf.org/html/rfc6455#section-1.4' xlink:href='https://tools.ietf.org/html/rfc6455#section-1.4' target='_top' title='https://tools.ietf.org/html/rfc6455#section-1.4' xlink:title='https://tools.ietf.org/html/rfc6455#section-1.4' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='192' x='205.5' y='977.4609'>
        WebSocket Closing handshake
      </text>
    </a>
    <polygon fill='#A80036' points='202,1007.5137,192,1011.5137,202,1015.5137,198,1011.5137' style='stroke: #A80036; stroke-width: 1.0;'/>
    <line style='stroke: #A80036; stroke-width: 1.0;' x1='196' x2='411' y1='1011.5137' y2='1011.5137'/>
    <text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacingAndGlyphs' textLength='192' x='205.5' y='1006.7715'>
      WebSocket Closing handshake
    </text>
    <path d='M425.094,6.1328 C425.034,6.1328 424.989,6.1768 424.969,6.2268 L422.031,13.0398 L422,13.2278 L422,14.0408 C422,14.1008 422.034,14.1348 422.094,14.1348 L428.907,14.1348 C428.967,14.1348 429.001,14.1008 429.001,14.0408 L429.001,13.2278 L428.97,13.0398 L426.032,6.2268 C426.012,6.1768 425.967,6.1328 425.907,6.1328 L425.094,6.1328 M425,9.1328 L426,9.1328 L426,11.1328 L425,11.1328 L425,9.1328 M425,12.1328 L426,12.1328 L426,13.1328 L425,13.1328 L425,12.1328 ' fill='#888888' style='stroke: ; stroke-width: 0.0; stroke-dasharray: ;'/>
    <text fill='#888888' font-family='sans-serif' font-size='12' lengthAdjust='spacingAndGlyphs' textLength='186' x='431' y='14.6016'>
      Do not test in production, test in
    </text>
    <a href='#WS_API_Services_Sandbox' xlink:href='#WS_API_Services_Sandbox' target='_top' title='#WS_API_Services_Sandbox' xlink:title='#WS_API_Services_Sandbox' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='12' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='50' x='621' y='14.6016'>
        sandbox
      </text>
    </a>
    <path d='M562,1075.002 L558.25,1081.252 L560.75,1081.252 L560.75,1085.002 L564.5,1078.752 L562,1078.752 L562,1075.002 ' fill='#888888' style='stroke: ; stroke-width: 0.0; stroke-dasharray: ;'/>
    <text fill='#888888' font-family='sans-serif' font-size='10' lengthAdjust='spacingAndGlyphs' textLength='0' x='571' y='1086.6426'/>
    <a href='https://power.trade' xlink:href='https://power.trade' target='_top' title='https://power.trade' xlink:title='https://power.trade' xlink:actuate='onRequest' xlink:show='new' xlink:type='simple'>
      <text fill='#0000FF' font-family='sans-serif' font-size='9' lengthAdjust='spacingAndGlyphs' text-decoration='underline' textLength='100' x='571' y='1086.8535'>
        PowerTrade Exchange
      </text>
    </a>
    <!--MD5=[302aa32174905a0f3060ad0ccc314ac7]
@startuml session_control_with_auth



skinparam sequenceMessageAlign center


right header
    <size:12><&warning>Do not test in production, test in [[#WS_API_Services_Sandbox sandbox]]</size>
endheader

right footer <size:15><&bolt></size> <size:9>[[https://power.trade PowerTrade Exchange]]</size>


group <b>Connect to secure WebSocket URI</b>

    Client -> Server : [[https://tools.ietf.org/html/rfc6455#section-1.3 WebSocket Opening handshake]]
    Client <- Server : WebSocket Opening handshake
end

group <b>[OPTIONAL] Authentication</b> (see if required in [[#WS_API_Services Table of API Services]])

    Client -> Server : 1) <b>[[#login login]]</b>
    Client <- Server : 2) <b>[[#login_accepted login_accepted]]</b>
    ... **or in case of failure**: ...
    Client <- - Server : 2) <b>[[#login_rejected login_rejected]]</b>

end

group <b>Session openning</b>

    Client -> Server : 1) <b>[[#start_session start_session]]</b>
    Client <- Server : 2) <b>[[#session_started session_started]]</b>

    group to keep session alive, heartbeating is required from now on
        Client <- Server : a) <b>[[#heartbeat heartbeat]]</b>
        Client -> Server : b) <b>[[#heartbeat heartbeat]]</b>
    end

    Client <- Server : 3) <b>[[#channel_added channel_added]]</b>

    note right: with assigned <b>[[#channel_id channel_id]]</b>

    Client -> Server : 4) <b>[[#request_stream request_stream]]</b>

    note left: with <b>[[#channel_id channel_id]]</b>\nfrom <b>[[#channel_added channel_added]]</b>

    Client <- Server : 5) <b>[[#stream_started stream_started]]</b>
end

group <b>Service-specific protocol</b>

    group to keep session alive,\nmake sure that Client is idle less than 15 sec\nby sending <b>heartbeat</b> to Server during idle periods\nso Server will see that Client is alive
        Client -> Server : <b>[[#heartbeat heartbeat]]</b>
    end

    group always handshake Server's heartbeat too
        Client <- Server : a) <b>[[#heartbeat heartbeat]]</b>
        Client -> Server : b) <b>[[#heartbeat heartbeat]]</b>
    end
end

group <b>Session ending</b>

    Client -> Server : 1) <b>[[#logout logout]]</b>
    Client <- Server : 2) <b>[[#session_ended session_ended]]</b>

end

group <b>Closing WebSocket</b>

    Client -> Server : [[https://tools.ietf.org/html/rfc6455#section-1.4 WebSocket Closing handshake]]
    Client <- Server : WebSocket Closing handshake

end

@enduml

PlantUML version 1.2020.06(Sun Apr 05 21:38:32 JST 2020)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 15.0.1+9-18
Operating System: Mac OS X
Default Encoding: UTF-8
Language: en
Country: JP
-->
  </g>
</svg>